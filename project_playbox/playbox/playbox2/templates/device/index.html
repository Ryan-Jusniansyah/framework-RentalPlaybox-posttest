{% extends 'homepage/base.html' %}
{% block title %} Daftar Device {% endblock%}

{% block content %}
<div class="container">
    <h1>Daftar Device</h1>
    <a href="{% url 'device_create' %}" class="btn btn-primary mb-3">Tambah Device</a>
    <form method="GET" action="{% url 'device_index' %}" class="d-flex mb-3">
        <input type="search" class="form-control me-2" name="q" placeholder="Cari Device..." value="{{ query|default:"" }}" aria-label="Search">
        <button class="btn btn-outline-success" type="submit">Cari</button>
    </form>
    <table class="table">
        <thead>
            <tr>
                <th>No.Device</th>
                <th>Nama Device</th>
                <th>Fasilitas</th>
                <th>Bonus</th>
                <th>Tanggal Masuk</th>
                <th>Penerima Device</th>
                <th>Aksi</th>
            </tr>
        </thead>
        <tbody>
            {% for device in devices %}
            <tr>
                <td>{{ device.noDevice }}</td>
                <td>{{ device.namaDevice }}</td>
                <td>{{ device.fasilitas}}</td>
                <td>{{ device.bonus }}</td>
                <td>{{ device.tanggalMasuk }}</td>
                <td>{{ device.admin.namaAdmin }}</td>
                <td>
                    <a href="{% url 'device_update' device.id %}" class="btn btn-sm btn-warning">Ubah</a>
                    <button class=" btn btn-sm btn-danger" onclick="confirmDelete({{ device.id }})">Hapus</button>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="6" class="text-center">Belum ada device</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
    function confirmDelete(deviceId) {
    Swal.fire({
    title: 'Data Device akan dihapus',
    text: 'Data tidak akan bisa dikembalikan!',
    icon: 'warning',
    showCancelButton: true,
    confirmButtonColor: '#3085d6',
    cancelButtonColor: '#d33',
    confirmButtonText: 'Ya, Hapus!'
    }).then((result) => {
    if (result.isConfirmed) {
    // Ini AJAX
    fetch(`/device/delete/${deviceId}`, {
    method: 'POST',
    headers: {
    'X-CSRFToken': '{{ csrf_token }}'
    }
    }).then(response => {
    if (response.ok) {
    Swal.fire(
    'Deleted!',
    'Device has been deleted.',
    'success'
    ).then(() => {
    // Reload the page after success
    window.location.reload();
    });
    } else {
    Swal.fire(
    'Error!',
    'There was an issue deleting the device.',
    'error'
    );
    }
    });
    }
    });
    }
</script>
{% endblock %}